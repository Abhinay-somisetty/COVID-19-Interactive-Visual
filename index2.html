<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel='icon' href="image/corona.jpg"/>
    <title>Final Project</title>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="d3-tip.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css" />
    <style>


        select {
            display: block;
        }
        .bar {
            fill: #ff0c1c;
            opacity: 0.8;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: optimizeSpeed;
        }
        .position {
            float:right;
            padding-right: 20px;
        }
        .left {
            padding-left: 20px;
            padding-top: 20px;
            padding-right: 20px;
        }

        ul {
            font: 12px sans-serif;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px;
           /* padding-bottom: 100px; Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .button {
            background-color: #555555;/* black */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
        .button2 {
            background-color: #385e4d;
            border: none;
            color: white;
            align:right;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        } /* Blue */
    </style>
</head>
<body style="background-image: url('image/UN.png'); background-repeat: no-repeat;background-size: 30% 25%;background-position: center; ">
<!--<body style="background-image: url('white.jpg'); background-repeat: no-repeat;background-size:cover;background-position: center; ">-->
<div>
    <center><h2 style="color:#5c3438;font-size:250%;" ><b>Day-Wise Corona Cases in each country</b></h2>

    </center>
    <!-- Trigger/Open The Modal -->
    <button id="myBtn" class="button2" style="position: center; right: 20px;" align="right">Know me</button>

    <!-- The Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>In this screen you can select country from drop down and view a graph plotted the number of corona cases from
                starting to april 9th.
                The link here takes you the dataset we have used
                <a href="https://github.com/abhinay-somisetty/Covid-Data-Visual/tree/master/data">DATA SOURCE.</a>
                You can navigate to the next or to the previous screen using the buttons at the bottom of the page.

            </p>
            <p >
                <b>Q1: How did you choose your particular visual encodings and interaction techniques?</b>
                <br>  The dataset for our Visualization is 'COVID-19 per country for April 9th'.We believed that a map would be helpful to visualize the dataset.
                Initially we thought of using a pointer to point on each country and try to explore the data, but we were not able to achieve the desired results. So we have opted
                tool tip where, when we mouse hover on any country it shows the covid-19 cases,deaths,total population of that country, and percentage of population affected.
                We also added zooming feature to the map. We can zoom into the map by double tapping on specific country. If we pinch out we can Zoom out.
                <br>
                <br><b>Q2: What alternatives did you consider and how did you arrive at your ultimate choices?</b>
                <br> Ans: Our alternative approach was to have a multi-line graph showing the confirmed covid cases in the last 5 days.
                However, that would not have been very effective, as the dataset is very humungous and having multiple lines per country would have been very messy.
                Thus, we decided to have a world map exciting our scheme without omitting any data and making the interactive visualization easy to understand.
                <br>
                <br><b>Q3: Development Process.</b>

                <br>Data Wrangling : Sheryl Bernard
                <br>Function definitions and UI : Abhinay Somisetty
                <br>D3 Adaption Functions : Hemanth Rachakonda
                <br>Debugging : Combined efforts
                <br>
                <br><b> Q4: Commentary of the Development Process.</b>
                <br>Ans:
                Data wrangling: This was the most tedious task as the raw data was pretty random and had a lot of NULL/NA values. The Covid-19 dataset was published by WHO.
                Also, we thought it will make more sense to have population with cumulative death and confirmed cases, for which we joined another dataset of country population.
                We filtered the data to the most recent date that is 04/09. We included columns like confirmed cases,cumulative deaths and also created a new calculated  column
                Percent_Population_Affected to better understand and make an effective visual.
                We used Trifacta for data wrangling.

                Function definitions and UI: We initially created pseudocodes for the required functions that was supposed to be implemented and designed a skeleton of our code.
                Post this, we created a raw sketch of the visualization.

                D3 adaptation of functions: Since we had the pseudocode, it was easy to adapt it to D3 environment. It took us few hours to comprehend the implementation of concepts.

                Debugging: Pre-existing D3 functions were still not working due to syntactical differences from other coding languages.
                Due to a lot of null or zeros in the dataset, we had to filter out the data for proper visualization
                <br>
                <br><b>Q5: Time spent developing the application.</b>
                <br> Ans: For data analysis and wrangling it took 12 hrs and it took us approximately 60-70 hours to implement and debug the code.

            </p>
        </div>

    </div>
    <h3 style="color:rgba(34,40,41,0.75);font-size:150%;font-family:verdana;" align="center"><b>Country</b></h3>
    <p></p>
</div>
<div>

           <!-- <span class="position">
           <img src="corona.jpg" width="200" height="150">
            </span>-->
</div>
   <!-- <button onclick="myFunction()">Know me</button>

<h2>Modal Example</h2>-->



<div id='vis-container' xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" align="center" ></div>

<!--
   body {
            background-image: url('world.jpg');
            background-repeat: no-repeat;
            background-size: 100%;

        }

//style="margin: 200px"




<center><div style = 'padding-bottom: 25px'>

    <p>Let's now explore gender biased statistics</p><a href="ratio.html"> Sex Ratio of Players with respect to Sports.</a>

</div></center>

-->
 <footer style="float: right;color:#0ea2ff; padding-right: 75px"><left><p>Designed By: Abhinay, Hemanth, Sheryl</p></left></footer>



<script type="text/javascript">
    // Load and munge data, then make the visualization.
   // console.log(svg-container.d)
    var fileName = "data/new_who.csv";
    var years = ["1/9","1/10","1/11","1/12","1/13","1/14","1/15","1/16","1/17","1/18","1/19","1/20","1/21","1/22","1/23","1/24","1/25","1/26","1/27","1/28","1/29","1/30","1/31","2/1","2/2","2/3","2/4","2/5","2/6","2/7","2/8","2/9","2/10","2/11","2/12","2/13","2/14","2/15","2/16","2/17","2/18","2/19","2/20","2/21","2/22","2/23","2/24","2/25","2/26","2/27","2/28","2/29","3/1","3/2","3/3","3/4","3/5","3/6","3/7","3/8","3/9","3/10","3/11","3/12","3/13","3/14","3/15","3/16","3/17","3/18","3/19","3/20","3/21","3/22","3/23","3/24","3/25","3/26","3/27","3/28","3/29","3/30","3/31","4/1","4/2","4/3","4/4","4/5","4/6","4/7","4/8","4/9"];

    // d3.csv(fileName, function(error,data){
    //     console.log(data);
    // });

    d3.csv(fileName, function(error, data) {
        var countryMap = {};
        var country;
        data.forEach(function(d) {
            country = d.Country_Name;
            //console.log(country);
            countryMap[country] = [];
            //console.log(countryMap[country]);
            // { countryName: [ bar1Val, bar2Val, ... ] }
            years.forEach(function(field) {
                countryMap[country].push( +d[field] );
            });

            //console.log(countryMap);
        });
        //var count = Object.keys(countryMap[country]).length;
        //console.log(countryMap);
        delete countryMap['']
        makeVis(countryMap);

    });
    var tip = d3.tip().attr('class', 'd3-tip').html(function(d) { return d; });

    var body = d3.select("body").node().getBoundingClientRect();
    var makeVis = function(countryMap) {
        // Define dimensions of vis
        var margin = { top: 30, right: 50, bottom: 30, left: 50 },
            width  = 1000 - margin.left - margin.right,
            //width = body.width,
           // console.log(width);
            height = 500 - margin.top  - margin.bottom;
        console.log(width);
        // Make x scale
        var xScale = d3.scale.ordinal()
            .domain(years)
            //.range([width, 0]);
            .rangeRoundBands([0, 1400], 0.1);

        // Make y scale, the domain will be defined on bar update
        var yScale = d3.scale.linear()
            .range([height, 0]);

        // Create canvas + margin.left + margin.right
        var canvas = d3.select("#vis-container")
            .append("svg")
            .attr("width",  1500 )
            .attr("height", height+ margin.left + margin.right)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Make x-axis and add to canvas
        var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient("bottom")
           ;
        //.tickFormat(d3.time.format("%m-%d-%y"));

        canvas.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .style("text-anchor", "start")
            //.attr("transform", "rotate(90)")
            //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.1em")
            .attr("dy", ".15em")
            .attr("transform", "rotate(-80)");

        // Make y-axis and add to canvas
        var yAxis = d3.svg.axis()
            .scale(yScale)
            .orient("left");

        var yAxisHandleForUpdate = canvas.append("g")
            .attr("class", "y axis")
            .call(yAxis);

       yAxisHandleForUpdate.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".700em")
            .style("text-anchor", "end")
            .text("Number of Corona Cases");

        var updateBars = function(data) {
            // First update the y-axis domain to match data
            yScale.domain( d3.extent(data) );
            yAxisHandleForUpdate.call(yAxis);

            var bars = canvas.selectAll(".bar").data(data);


            // Add bars for new data
            bars.enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", function(d,i) { return xScale( years[i] ); })
                .attr("width", xScale.rangeBand())
                .attr("y", function(d,i) { return yScale(d); })
                .attr("height", function(d,i) { return height - yScale(d); })
                .on("mouseover", tip.show)

                .on("mouseout", function(d){tip.hide});
            bars.call(tip);
            //.on("mouseout", handleMouseOut);

            // Update old ones, already have x / width from before
            bars
                .transition().duration(250)
                .attr("y", function(d,i) { return yScale(d); })
                .attr("height", function(d,i) {
                    return height - yScale(d);
                });

            // Remove old ones
            bars.exit().remove();
        };

        // Handler for dropdown value change
        var dropdownChange = function() {
            // debugger;
            var newcountry = d3.select(this).property('value');
            if (newcountry === undefined){
                newcountry = d3.select('#drop_down_id').property('value');
            }
                newData   = countryMap[newcountry];

            updateBars(newData);
        };

        // Get names of countrys, for dropdown
        var countrys = Object.keys(countryMap).sort();


        var dropdown = d3.select("#vis-container")
            .insert("select", "svg")
            .attr("id", "drop_down_id")
            .on("change", dropdownChange);

        dropdown.selectAll("option")
            .data(countrys)
            .enter().append("option")
            .attr("value", function (d) { return d; })
            .text(function (d) {
                return d[0].toUpperCase() + d.slice(1,d.length);
            });
        var x = d3.select("#drop_down_id")
            .on("change", dropdownChange);

        var initialData = countryMap[ countrys[0] ];
        updateBars(initialData);
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        var country_param = urlParams.get('country');
        if (country_param !== undefined) {
            d3.select("#drop_down_id").property('value', country_param);
            d3.select("#drop_down_id").on("change")();
        }
    };
    function myFunction() {
        alert("Hello\nHow are you? \nthere?");
    }

    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
<br><br><p style ="padding-left: 50px;padding-right:50px">
    Stay aware of the latest information on the COVID-19 outbreak, available on the
    <a href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/advice-for-public">WHO website</a>

    and through your national and local public health authority. Most countries around the world have seen cases of COVID-19 and
    many are experiencing outbreaks. Authorities in China and some other countries have succeeded in slowing their outbreaks.
    However, the situation is unpredictable so check regularly for the latest news.
</p>
<form style="padding-top: 75px;padding-left: 25px; padding-bottom: 50px" ;  method="get" action="index1.html" >
    <button class="button" type="submit" style="color:#64dfff;">Previous</button>
</form>
<!--<form style="padding-top: 25px;padding-right: 25px; padding-bottom: 50px" ;  method="get" action="index.html" align="right">
    <button class="button" type="submit" style="color:#64dfff;">Next</button>
</form>

<div style="width:1400px;">
    <div style="float: left; width: 130px">
        <form id="thisone" action="index1.html" method="post">
            <input class="button" type="submit" name = "Previous" value="Previous" style="color:#64dfff;" >
        </form>
    </div>
    <div style="float: right; width: 1px ">
        <form id="thistoo" action="index1.html" method="post" align="right">
            <input class="button" type="submit" name = "Next" value="Next" style="color:#64dfff;" >
        </form>
    </div>
</div>-->
</body>
</html>